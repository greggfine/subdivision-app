{"ast":null,"code":"//    abc_renderer.js: API to render to SVG/Raphael/whatever rendering engine\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com)\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n/*global Math, console */\nvar glyphs = require('./abc_glyphs');\n\nvar spacing = require('./abc_spacing');\n\nvar sprintf = require('./sprintf');\n\nvar Svg = require('./svg');\n/**\n * Implements the API for rendering ABCJS Abstract Rendering Structure to a canvas/paper (e.g. SVG, Raphael, etc)\n * @param {Object} paper\n * @param {bool} doRegression\n */\n\n\nvar Renderer = function (paper, doRegression, shouldAddClasses) {\n  this.paper = new Svg(paper);\n  this.controller = null; //TODO-GD only used when drawing the ABCJS ARS to connect the controller with the elements for highlighting\n\n  this.space = 3 * spacing.SPACE;\n  this.padding = {}; // renderer's padding is managed by the controller\n\n  this.doRegression = doRegression;\n  this.shouldAddClasses = shouldAddClasses;\n  if (this.doRegression) this.regressionLines = [];\n  this.reset();\n};\n\nRenderer.prototype.reset = function () {\n  this.paper.clear();\n  this.y = 0;\n  this.abctune = null;\n  this.lastM = null;\n  this.ingroup = false;\n  this.path = null;\n  this.isPrint = false;\n  this.initVerticalSpace();\n  if (this.doRegression) this.regressionLines = []; // HACK-PER: There was a problem in Raphael where every path string that was sent to it was cached.\n  // That was causing the browser's memory to steadily grow until the browser went slower and slower until\n  // it crashed. The fix to that was a patch to Raphael, so it is only patched on the versions of this library that\n  // bundle Raphael with it. Also, if Raphael gets an update, then that patch will be lost. On version 2.1.2 of Raphael,\n  // the patch is on line 1542 and 1545 and it is:\n  //             p[ps].sleep = 1;\n};\n\nRenderer.prototype.createElemSet = function () {\n  return this.paper.openGroup();\n};\n\nRenderer.prototype.closeElemSet = function () {\n  return this.paper.closeGroup();\n};\n/**\n * Set whether we are formatting this for the screen, or as a preview for creating a PDF version.\n * @param {bool} isPrint\n */\n\n\nRenderer.prototype.setPrintMode = function (isPrint) {\n  this.isPrint = isPrint;\n};\n/**\n * Set the size of the canvas.\n * @param {object} maxwidth\n * @param {object} scale\n */\n\n\nRenderer.prototype.setPaperSize = function (maxwidth, scale, responsive) {\n  var w = (maxwidth + this.padding.right) * scale;\n  var h = (this.y + this.padding.bottom) * scale;\n  if (this.isPrint) h = Math.max(h, 1056); // 11in x 72pt/in x 1.33px/pt\n  // TODO-PER: We are letting the page get as long as it needs now, but eventually that should go to a second page.\n\n  if (this.doRegression) this.regressionLines.push(\"PAPER SIZE: (\" + w + \",\" + h + \")\"); // for accessibility\n\n  var text = \"Sheet Music\";\n  if (this.abctune && this.abctune.metaText && this.abctune.metaText.title) text += \" for \\\"\" + this.abctune.metaText.title + '\"';\n  this.paper.setTitle(text);\n  var parentStyles = {\n    overflow: \"hidden\"\n  };\n\n  if (responsive === 'resize') {\n    this.paper.setResponsiveWidth(w, h);\n  } else {\n    parentStyles.width = \"\";\n    parentStyles.height = h + \"px\";\n\n    if (scale < 1) {\n      parentStyles.width = w + \"px\";\n      this.paper.setSize(w / scale, h / scale);\n    } else this.paper.setSize(w, h);\n  }\n\n  this.paper.setScale(scale);\n  this.paper.setParentStyles(parentStyles);\n};\n/**\n * Set the padding\n * @param {object} params\n */\n\n\nRenderer.prototype.setPaddingOverride = function (params) {\n  this.paddingOverride = {\n    top: params.paddingtop,\n    bottom: params.paddingbottom,\n    right: params.paddingright,\n    left: params.paddingleft\n  };\n};\n/**\n * Set the padding\n * @param {object} params\n */\n\n\nRenderer.prototype.setPadding = function (abctune) {\n  // If the padding is set in the tune, then use that.\n  // Otherwise, if the padding is set in the override, use that.\n  // Otherwise, use the defaults (there are a different set of defaults for screen and print.)\n  function setPaddingVariable(self, paddingKey, formattingKey, printDefault, screenDefault) {\n    if (abctune.formatting[formattingKey] !== undefined) self.padding[paddingKey] = abctune.formatting[formattingKey];else if (self.paddingOverride[paddingKey] !== undefined) self.padding[paddingKey] = self.paddingOverride[paddingKey];else if (self.isPrint) self.padding[paddingKey] = printDefault;else self.padding[paddingKey] = screenDefault;\n  } // 1cm x 0.393701in/cm x 72pt/in x 1.33px/pt = 38px\n  // 1.8cm x 0.393701in/cm x 72pt/in x 1.33px/pt = 68px\n\n\n  setPaddingVariable(this, 'top', 'topmargin', 38, 15);\n  setPaddingVariable(this, 'bottom', 'botmargin', 38, 15);\n  setPaddingVariable(this, 'left', 'leftmargin', 68, 15);\n  setPaddingVariable(this, 'right', 'rightmargin', 68, 15);\n};\n/**\n * Some of the items on the page are not scaled, so adjust them in the opposite direction of scaling to cancel out the scaling.\n * @param {float} scale\n */\n\n\nRenderer.prototype.adjustNonScaledItems = function (scale) {\n  this.padding.top /= scale;\n  this.padding.bottom /= scale;\n  this.padding.left /= scale;\n  this.padding.right /= scale;\n  this.abctune.formatting.headerfont.size /= scale;\n  this.abctune.formatting.footerfont.size /= scale;\n};\n/**\n * Set the the values for all the configurable vertical space options.\n */\n\n\nRenderer.prototype.initVerticalSpace = function () {\n  // conversion: 37.7953 = conversion factor for cm to px.\n  // All of the following values are in px.\n  this.spacing = {\n    composer: 7.56,\n    // Set the vertical space above the composer.\n    graceBefore: 8.67,\n    // Define the space before, inside and after the grace notes.\n    graceInside: 10.67,\n    graceAfter: 16,\n    info: 0,\n    // Set the vertical space above the infoline.\n    lineSkipFactor: 1.1,\n    // Set the factor for spacing between lines of text. (multiply this by the font size)\n    music: 7.56,\n    // Set the vertical space above the first staff.\n    paragraphSkipFactor: 0.4,\n    // Set the factor for spacing between text paragraphs. (multiply this by the font size)\n    parts: 11.33,\n    // Set the vertical space above a new part.\n    slurHeight: 1.0,\n    // Set the slur height factor.\n    staffSeparation: 61.33,\n    // Do not put a staff system closer than <unit> from the previous system.\n    stemHeight: 26.67 + 10,\n    // Set the stem height.\n    subtitle: 3.78,\n    // Set the vertical space above the subtitle.\n    systemStaffSeparation: 48,\n    // Do not place the staves closer than <unit> inside a system. * This values applies to all staves when in the tune header. Otherwise, it applies to the next staff\n    text: 18.9,\n    // Set the vertical space above the history.\n    title: 7.56,\n    // Set the vertical space above the title.\n    top: 30.24,\n    //Set the vertical space above the tunes and on the top of the continuation pages.\n    vocal: 30.67,\n    // Set the vertical space above the lyrics under the staves.\n    words: 0 // Set the vertical space above the lyrics at the end of the tune.\n\n  };\n  /*\n  TODO-PER: Handle the x-coordinate spacing items, too.\n  maxshrink <float>Default: 0.65\n  Set how much to compress horizontally when music line breaks\n  are automatic.\n  <float> must be between 0 (natural spacing)\n  and 1 (max shrinking).\n  // This next value is used to compute the natural spacing of\n  // the notes. The base spacing of the crotchet is always\n  // 40 pts. When the duration of a note type is twice the\n  // duration of an other note type, its spacing is multiplied\n  // by this factor.\n  // The default value causes the note spacing to be multiplied\n  // by 2 when its duration is multiplied by 4, i.e. the\n  // space of the semibreve is 80 pts and the space of the\n  // semiquaver is 20 pts.\n  // Setting this value to 1 sets all note spacing to 40 pts.\n  noteSpacingFactor: 1.414, // Set the note spacing factor to <float> (range 1..2).\n  scale <float> Default: 0.75 Set the page scale factor. Note that the header and footer are not scaled.\n  stretchlast <float>Default: 0.8\n  Stretch the last music line of a tune when it exceeds\n  the <float> fraction of the page width.\n  <float> range is 0.0 to 1.0.\n   */\n};\n\nRenderer.prototype.setVerticalSpace = function (formatting) {\n  // conversion from pts to px 4/3\n  if (formatting.staffsep !== undefined) this.spacing.staffSeparation = formatting.staffsep * 4 / 3;\n  if (formatting.composerspace !== undefined) this.spacing.composer = formatting.composerspace * 4 / 3;\n  if (formatting.partsspace !== undefined) this.spacing.parts = formatting.partsspace * 4 / 3;\n  if (formatting.textspace !== undefined) this.spacing.text = formatting.textspace * 4 / 3;\n  if (formatting.musicspace !== undefined) this.spacing.music = formatting.musicspace * 4 / 3;\n  if (formatting.titlespace !== undefined) this.spacing.title = formatting.titlespace * 4 / 3;\n  if (formatting.sysstaffsep !== undefined) this.spacing.systemStaffSeparation = formatting.sysstaffsep * 4 / 3;\n  if (formatting.subtitlespace !== undefined) this.spacing.subtitle = formatting.subtitlespace * 4 / 3;\n  if (formatting.topspace !== undefined) this.spacing.top = formatting.topspace * 4 / 3;\n  if (formatting.vocalspace !== undefined) this.spacing.vocal = formatting.vocalspace * 4 / 3;\n  if (formatting.wordsspace !== undefined) this.spacing.words = formatting.wordsspace * 4 / 3;\n};\n/**\n * Leave space at the top of the paper\n * @param {object} abctune\n */\n\n\nRenderer.prototype.topMargin = function (abctune) {\n  this.moveY(this.padding.top);\n};\n/**\n * Leave space before printing the music\n */\n\n\nRenderer.prototype.addMusicPadding = function () {\n  this.moveY(this.spacing.music);\n};\n/**\n * Leave space before printing a staff system\n */\n\n\nRenderer.prototype.addStaffPadding = function (lastStaffGroup, thisStaffGroup) {\n  var lastStaff = lastStaffGroup.staffs[lastStaffGroup.staffs.length - 1];\n  var lastBottomLine = -(lastStaff.bottom - 2); // The 2 is because the scale goes to 2 below the last line.\n\n  var nextTopLine = thisStaffGroup.staffs[0].top - 10; // Because 10 represents the top line.\n\n  var naturalSeparation = nextTopLine + lastBottomLine; // This is how far apart they'd be without extra spacing\n\n  var separationInPixels = naturalSeparation * spacing.STEP;\n  if (separationInPixels < this.spacing.staffSeparation) this.moveY(this.spacing.staffSeparation - separationInPixels);\n};\n/**\n * Text that goes above the score\n * @param {number} width\n * @param {object} abctune\n */\n\n\nRenderer.prototype.engraveTopText = function (width, abctune) {\n  if (abctune.metaText.header && this.isPrint) {\n    // Note: whether there is a header or not doesn't change any other positioning, so this doesn't change the Y-coordinate.\n    // This text goes above the margin, so we'll temporarily move up.\n    var headerTextHeight = this.getTextSize(\"XXXX\", \"headerfont\", 'abcjs-header abcjs-meta-top').height;\n    this.y -= headerTextHeight;\n    this.outputTextIf(this.padding.left, abctune.metaText.header.left, 'headerfont', 'header meta-top', 0, null, 'start');\n    this.outputTextIf(this.padding.left + width / 2, abctune.metaText.header.center, 'headerfont', 'header meta-top', 0, null, 'middle');\n    this.outputTextIf(this.padding.left + width, abctune.metaText.header.right, 'headerfont', 'header meta-top', 0, null, 'end');\n    this.y += headerTextHeight;\n  }\n\n  if (this.isPrint) this.moveY(this.spacing.top);\n  this.outputTextIf(this.padding.left + width / 2, abctune.metaText.title, 'titlefont', 'title meta-top', this.spacing.title, 0, 'middle');\n  if (abctune.lines[0]) this.outputTextIf(this.padding.left + width / 2, abctune.lines[0].subtitle, 'subtitlefont', 'text meta-top', this.spacing.subtitle, 0, 'middle');\n\n  if (abctune.metaText.rhythm || abctune.metaText.origin || abctune.metaText.composer) {\n    this.moveY(this.spacing.composer);\n    var rSpace = this.outputTextIf(this.padding.left, abctune.metaText.rhythm, 'infofont', 'meta-top', 0, null, \"start\");\n    var composerLine = \"\";\n    if (abctune.metaText.composer) composerLine += abctune.metaText.composer;\n    if (abctune.metaText.origin) composerLine += ' (' + abctune.metaText.origin + ')';\n\n    if (composerLine.length > 0) {\n      var space = this.outputTextIf(this.padding.left + width, composerLine, 'composerfont', 'meta-top', 0, null, \"end\");\n      this.moveY(space[1]);\n    } else {\n      this.moveY(rSpace[1]);\n    } // TODO-PER: The following is a hack to make the elements line up with abcm2ps. Don't know where the extra space is coming from.\n\n\n    this.moveY(-6); //} else if (this.isPrint) {\n    //\t// abcm2ps adds this space whether there is anything to write or not.\n    //\tthis.moveY(this.spacing.composer);\n    //\tvar space2 = this.getTextSize(\"M\", 'composerfont', 'meta-top');\n    //\tthis.moveY(space2.height);\n  }\n\n  this.outputTextIf(this.padding.left + width, abctune.metaText.author, 'composerfont', 'meta-top', 0, 0, \"end\"); //this.skipSpaceY();\n\n  this.outputTextIf(this.padding.left, abctune.metaText.partOrder, 'partsfont', 'meta-bottom', 0, 0, \"start\");\n};\n/**\n * Text that goes below the score\n * @param {number} width\n * @param {object} abctune\n */\n\n\nRenderer.prototype.engraveExtraText = function (width, abctune) {\n  this.lineNumber = null;\n  this.measureNumber = null;\n  this.noteNumber = null;\n  this.voiceNumber = null;\n  var extraText;\n\n  if (abctune.metaText.unalignedWords) {\n    extraText = \"\";\n\n    for (var j = 0; j < abctune.metaText.unalignedWords.length; j++) {\n      if (typeof abctune.metaText.unalignedWords[j] === 'string') extraText += abctune.metaText.unalignedWords[j] + \"\\n\";else {\n        for (var k = 0; k < abctune.metaText.unalignedWords[j].length; k++) {\n          extraText += \" FONT \" + abctune.metaText.unalignedWords[j][k].text;\n        }\n\n        extraText += \"\\n\";\n      }\n    }\n\n    this.outputTextIf(this.padding.left + spacing.INDENT, extraText, 'wordsfont', 'meta-bottom', this.spacing.words, 2, \"start\");\n  }\n\n  extraText = \"\";\n  if (abctune.metaText.book) extraText += \"Book: \" + abctune.metaText.book + \"\\n\";\n  if (abctune.metaText.source) extraText += \"Source: \" + abctune.metaText.source + \"\\n\";\n  if (abctune.metaText.discography) extraText += \"Discography: \" + abctune.metaText.discography + \"\\n\";\n  if (abctune.metaText.notes) extraText += \"Notes: \" + abctune.metaText.notes + \"\\n\";\n  if (abctune.metaText.transcription) extraText += \"Transcription: \" + abctune.metaText.transcription + \"\\n\";\n  if (abctune.metaText.history) extraText += \"History: \" + abctune.metaText.history + \"\\n\";\n  if (abctune.metaText['abc-copyright']) extraText += \"Copyright: \" + abctune.metaText['abc-copyright'] + \"\\n\";\n  if (abctune.metaText['abc-creator']) extraText += \"Creator: \" + abctune.metaText['abc-creator'] + \"\\n\";\n  if (abctune.metaText['abc-edited-by']) extraText += \"Edited By: \" + abctune.metaText['abc-edited-by'] + \"\\n\";\n  this.outputTextIf(this.padding.left, extraText, 'historyfont', 'meta-bottom', this.spacing.info, 0, \"start\");\n\n  if (abctune.metaText.footer && this.isPrint) {\n    // Note: whether there is a footer or not doesn't change any other positioning, so this doesn't change the Y-coordinate.\n    this.outputTextIf(this.padding.left, abctune.metaText.footer.left, 'footerfont', 'header meta-bottom', 0, null, 'start');\n    this.outputTextIf(this.padding.left + width / 2, abctune.metaText.footer.center, 'footerfont', 'header meta-bottom', 0, null, 'middle');\n    this.outputTextIf(this.padding.left + width, abctune.metaText.footer.right, 'footerfont', 'header meta-bottom', 0, null, 'end');\n  }\n};\n/**\n * Output text defined with %%text.\n * @param {array or string} text\n */\n\n\nRenderer.prototype.outputFreeText = function (text) {\n  if (text === \"\") {\n    // we do want to print out blank lines if they have been specified.\n    var hash = this.getFontAndAttr('textfont', 'defined-text');\n    this.moveY(hash.attr['font-size'] * 2); // move the distance of the line, plus the distance of the margin, which is also one line.\n  } else if (typeof text === 'string') this.outputTextIf(this.padding.left, text, 'textfont', 'defined-text', 0, 1, \"start\");else {\n    var str = \"\";\n    var isCentered = false; // The structure is wrong here: it requires an array to do centering, but it shouldn't have.\n\n    for (var i = 0; i < text.length; i++) {\n      if (text[i].font) str += \"FONT(\" + text[i].font + \")\";\n      str += text[i].text;\n      if (text[i].center) isCentered = true;\n    }\n\n    var alignment = isCentered ? 'middle' : 'start';\n    var x = isCentered ? this.controller.width / 2 : this.padding.left;\n    this.outputTextIf(x, str, 'textfont', 'defined-text', 0, 1, alignment);\n  }\n};\n/**\n * Output an extra subtitle that is defined later in the tune.\n */\n\n\nRenderer.prototype.outputSubtitle = function (width, subtitle) {\n  this.outputTextIf(this.padding.left + width / 2, subtitle, 'subtitlefont', 'text meta-top', this.spacing.subtitle, 0, 'middle');\n};\n/**\n * Begin a group of glyphs that will always be moved, scaled and highlighted together\n */\n\n\nRenderer.prototype.beginGroup = function () {\n  this.path = [];\n  this.lastM = [0, 0];\n  this.ingroup = true;\n};\n/**\n * Add a path to the current group\n * @param {Array} path\n * @private\n */\n\n\nRenderer.prototype.addPath = function (path) {\n  path = path || [];\n  if (path.length === 0) return;\n  path[0][0] = \"m\";\n  path[0][1] -= this.lastM[0];\n  path[0][2] -= this.lastM[1];\n  this.lastM[0] += path[0][1];\n  this.lastM[1] += path[0][2];\n  this.path.push(path[0]);\n\n  for (var i = 1, ii = path.length; i < ii; i++) {\n    if (path[i][0] === \"m\") {\n      this.lastM[0] += path[i][1];\n      this.lastM[1] += path[i][2];\n    }\n\n    this.path.push(path[i]);\n  }\n};\n/**\n * End a group of glyphs that will always be moved, scaled and highlighted together\n */\n\n\nRenderer.prototype.endGroup = function (klass) {\n  this.ingroup = false;\n  if (this.path.length === 0) return null;\n  var path = \"\";\n\n  for (var i = 0; i < this.path.length; i++) path += this.path[i].join(\" \");\n\n  var ret = this.paper.path({\n    path: path,\n    stroke: \"none\",\n    fill: \"#000000\",\n    'class': this.addClasses(klass)\n  });\n  this.path = [];\n  if (this.doRegression) this.addToRegression(ret);\n  return ret;\n};\n/**\n * gets scaled\n * @param {number} x1 start x\n * @param {number} x2 end x\n * @param {number} pitch pitch the stave line is drawn at\n */\n\n\nRenderer.prototype.printStaveLine = function (x1, x2, pitch, klass) {\n  var extraClass = \"staff\";\n  if (klass !== undefined) extraClass += \" \" + klass;\n  var isIE =\n  /*@cc_on!@*/\n  false; //IE detector\n\n  var dy = 0.35;\n  var fill = \"#000000\";\n\n  if (isIE) {\n    dy = 1;\n    fill = \"#666666\";\n  }\n\n  var y = this.calcY(pitch);\n  var pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x1, y - dy, x2, y - dy, x2, y + dy, x1, y + dy);\n  var ret = this.paper.pathToBack({\n    path: pathString,\n    stroke: \"none\",\n    fill: fill,\n    'class': this.addClasses(extraClass)\n  });\n  if (this.doRegression) this.addToRegression(ret);\n  return ret;\n};\n/**\n * gets scaled if not in a group\n * @param {number} x x coordinate of the stem\n * @param {number} dx stem width\n * @param {number} y1 y coordinate of the stem bottom\n * @param {number} y2 y coordinate of the stem top\n */\n\n\nRenderer.prototype.printStem = function (x, dx, y1, y2) {\n  if (dx < 0) {\n    // correct path \"handedness\" for intersection with other elements\n    var tmp = y2;\n    y2 = y1;\n    y1 = tmp;\n  }\n\n  var isIE =\n  /*@cc_on!@*/\n  false; //IE detector\n\n  var fill = \"#000000\";\n\n  if (isIE && dx < 1) {\n    dx = 1;\n    fill = \"#666666\";\n  }\n\n  if (~~x === x) x += 0.05; // raphael does weird rounding (for VML)\n\n  var pathArray = [[\"M\", x, y1], [\"L\", x, y2], [\"L\", x + dx, y2], [\"L\", x + dx, y1], [\"z\"]];\n\n  if (!isIE && this.ingroup) {\n    this.addPath(pathArray);\n  } else {\n    var path = \"\";\n\n    for (var i = 0; i < pathArray.length; i++) path += pathArray[i].join(\" \");\n\n    var ret = this.paper.pathToBack({\n      path: path,\n      stroke: \"none\",\n      fill: fill,\n      'class': this.addClasses('stem')\n    });\n    if (this.doRegression) this.addToRegression(ret);\n    return ret;\n  }\n};\n\nfunction kernSymbols(lastSymbol, thisSymbol, lastSymbolWidth) {\n  // This is just some adjustments to make it look better.\n  var width = lastSymbolWidth;\n  if (lastSymbol === 'f' && thisSymbol === 'f') width = width * 2 / 3;\n  if (lastSymbol === 'p' && thisSymbol === 'p') width = width * 5 / 6;\n  if (lastSymbol === 'f' && thisSymbol === 'z') width = width * 5 / 8;\n  return width;\n}\n/**\n * assumes this.y is set appropriately\n * if symbol is a multichar string without a . (as in scripts.staccato) 1 symbol per char is assumed\n * not scaled if not in printgroup\n */\n\n\nRenderer.prototype.printSymbol = function (x, offset, symbol, scalex, scaley, klass) {\n  var el;\n  var ycorr;\n  if (!symbol) return null;\n\n  if (symbol.length > 1 && symbol.indexOf(\".\") < 0) {\n    this.paper.openGroup();\n    var dx = 0;\n\n    for (var i = 0; i < symbol.length; i++) {\n      var s = symbol.charAt(i);\n      ycorr = glyphs.getYCorr(s);\n      el = glyphs.printSymbol(x + dx, this.calcY(offset + ycorr), s, this.paper, klass);\n\n      if (el) {\n        if (this.doRegression) this.addToRegression(el); //elemset.push(el);\n\n        if (i < symbol.length - 1) dx += kernSymbols(s, symbol.charAt(i + 1), glyphs.getSymbolWidth(s));\n      } else {\n        this.renderText(x, this.y, \"no symbol:\" + symbol, \"debugfont\", 'debug-msg', 'start');\n      }\n    }\n\n    return this.paper.closeGroup();\n  } else {\n    ycorr = glyphs.getYCorr(symbol);\n\n    if (this.ingroup) {\n      this.addPath(glyphs.getPathForSymbol(x, this.calcY(offset + ycorr), symbol, scalex, scaley));\n    } else {\n      el = glyphs.printSymbol(x, this.calcY(offset + ycorr), symbol, this.paper, klass);\n\n      if (el) {\n        if (this.doRegression) this.addToRegression(el);\n        return el;\n      } else this.renderText(x, this.y, \"no symbol:\" + symbol, \"debugfont\", 'debug-msg', 'start');\n    }\n\n    return null;\n  }\n};\n\nRenderer.prototype.scaleExistingElem = function (elem, scaleX, scaleY, x, y) {\n  this.paper.setAttributeOnElement(elem, {\n    style: \"transform:scale(\" + scaleX + \",\" + scaleY + \");transform-origin:\" + x + \"px \" + y + \"px;\"\n  });\n};\n\nRenderer.prototype.printPath = function (attrs) {\n  var ret = this.paper.path(attrs);\n  if (this.doRegression) this.addToRegression(ret);\n  return ret;\n};\n\nRenderer.prototype.drawBrace = function (xLeft, yTop, yBottom) {\n  //Tony\n  var yHeight = yBottom - yTop;\n  var xCurve = [7.5, -8, 21, 0, 18.5, -10.5, 7.5];\n  var yCurve = [0, yHeight / 5.5, yHeight / 3.14, yHeight / 2, yHeight / 2.93, yHeight / 4.88, 0];\n  var pathString = sprintf(\"M %f %f C %f %f %f %f %f %f C %f %f %f %f %f %f z\", xLeft + xCurve[0], yTop + yCurve[0], xLeft + xCurve[1], yTop + yCurve[1], xLeft + xCurve[2], yTop + yCurve[2], xLeft + xCurve[3], yTop + yCurve[3], xLeft + xCurve[4], yTop + yCurve[4], xLeft + xCurve[5], yTop + yCurve[5], xLeft + xCurve[6], yTop + yCurve[6]);\n  var ret1 = this.paper.path({\n    path: pathString,\n    stroke: \"#000000\",\n    fill: \"#000000\",\n    'class': this.addClasses('brace')\n  });\n  xCurve = [0, 17.5, -7.5, 6.6, -5, 20, 0];\n  yCurve = [yHeight / 2, yHeight / 1.46, yHeight / 1.22, yHeight, yHeight / 1.19, yHeight / 1.42, yHeight / 2];\n  pathString = sprintf(\"M %f %f C %f %f %f %f %f %f C %f %f %f %f %f %f z\", xLeft + xCurve[0], yTop + yCurve[0], xLeft + xCurve[1], yTop + yCurve[1], xLeft + xCurve[2], yTop + yCurve[2], xLeft + xCurve[3], yTop + yCurve[3], xLeft + xCurve[4], yTop + yCurve[4], xLeft + xCurve[5], yTop + yCurve[5], xLeft + xCurve[6], yTop + yCurve[6]);\n  var ret2 = this.paper.path({\n    path: pathString,\n    stroke: \"#000000\",\n    fill: \"#000000\",\n    'class': this.addClasses('brace')\n  });\n\n  if (this.doRegression) {\n    this.addToRegression(ret1);\n    this.addToRegression(ret2);\n  }\n\n  return ret1 + ret2;\n};\n\nRenderer.prototype.drawArc = function (x1, x2, pitch1, pitch2, above, klass, isTie) {\n  // If it is a tie vs. a slur, draw it shallower.\n  var spacing = isTie ? 1.2 : 1.5;\n  x1 = x1 + 6;\n  x2 = x2 + 4;\n  pitch1 = pitch1 + (above ? spacing : -spacing);\n  pitch2 = pitch2 + (above ? spacing : -spacing);\n  var y1 = this.calcY(pitch1);\n  var y2 = this.calcY(pitch2); //unit direction vector\n\n  var dx = x2 - x1;\n  var dy = y2 - y1;\n  var norm = Math.sqrt(dx * dx + dy * dy);\n  var ux = dx / norm;\n  var uy = dy / norm;\n  var flatten = norm / 3.5;\n  var maxFlatten = isTie ? 10 : 25; // If it is a tie vs. a slur, draw it shallower.\n\n  var curve = (above ? -1 : 1) * Math.min(maxFlatten, Math.max(4, flatten));\n  var controlx1 = x1 + flatten * ux - curve * uy;\n  var controly1 = y1 + flatten * uy + curve * ux;\n  var controlx2 = x2 - flatten * ux - curve * uy;\n  var controly2 = y2 - flatten * uy + curve * ux;\n  var thickness = 2;\n  var pathString = sprintf(\"M %f %f C %f %f %f %f %f %f C %f %f %f %f %f %f z\", x1, y1, controlx1, controly1, controlx2, controly2, x2, y2, controlx2 - thickness * uy, controly2 + thickness * ux, controlx1 - thickness * uy, controly1 + thickness * ux, x1, y1);\n  if (klass) klass += ' slur';else klass = 'slur';\n  var ret = this.paper.path({\n    path: pathString,\n    stroke: \"none\",\n    fill: \"#000000\",\n    'class': this.addClasses(klass)\n  });\n  if (this.doRegression) this.addToRegression(ret);\n  return ret;\n};\n/**\n * Calculates the y for a given pitch value (relative to the stave the renderer is currently printing)\n * @param {number} ofs pitch value (bottom C on a G clef = 0, D=1, etc.)\n */\n\n\nRenderer.prototype.calcY = function (ofs) {\n  return this.y - ofs * spacing.STEP;\n};\n/**\n * Print @param {number} numLines. If there is 1 line it is the B line. Otherwise the bottom line is the E line.\n */\n\n\nRenderer.prototype.printStave = function (startx, endx, numLines) {\n  var klass = \"top-line\";\n  this.paper.openGroup({\n    prepend: true\n  }); // If there is one line, it is the B line. Otherwise, the bottom line is the E line.\n\n  if (numLines === 1) {\n    this.printStaveLine(startx, endx, 6, klass);\n    return;\n  }\n\n  for (var i = numLines - 1; i >= 0; i--) {\n    this.printStaveLine(startx, endx, (i + 1) * 2, klass);\n    klass = undefined;\n  }\n\n  this.paper.closeGroup();\n};\n/**\n *\n * @private\n */\n\n\nRenderer.prototype.addClasses = function (c, isNote) {\n  if (!this.shouldAddClasses) return \"\";\n  var ret = [];\n  if (c.length > 0) ret.push(c);\n  if (this.lineNumber !== null && this.lineNumber !== undefined) ret.push(\"l\" + this.lineNumber);\n  if (this.measureNumber !== null && this.measureNumber !== undefined) ret.push(\"m\" + this.measureNumber);\n  if (this.voiceNumber !== null && this.voiceNumber !== undefined) ret.push(\"v\" + this.voiceNumber);\n  if (c.indexOf('note') >= 0 && this.noteNumber !== null && this.noteNumber !== undefined) ret.push(\"n\" + this.noteNumber); // add a prefix to all classes that abcjs adds.\n\n  if (ret.length > 0) {\n    ret = ret.join(' '); // Some strings are compound classes - that is, specify more than one class in a string.\n\n    ret = ret.split(' ');\n\n    for (var i = 0; i < ret.length; i++) {\n      if (ret[i].indexOf('abcjs-') !== 0 && ret[i].length > 0) // if the prefix doesn't already exist and the class is not blank.\n        ret[i] = 'abcjs-' + ret[i];\n    }\n  }\n\n  return ret.join(' ');\n};\n\nRenderer.prototype.getFontAndAttr = function (type, klass) {\n  var font = this.abctune.formatting[type]; // Raphael deliberately changes the font units to pixels for some reason, so we need to change points to pixels here.\n\n  if (font) font = {\n    face: font.face,\n    size: font.size * 4 / 3,\n    decoration: font.decoration,\n    style: font.style,\n    weight: font.weight,\n    box: font.box\n  };else font = {\n    face: \"Arial\",\n    size: 12 * 4 / 3,\n    decoration: \"underline\",\n    style: \"normal\",\n    weight: \"normal\"\n  };\n  var attr = {\n    \"font-size\": font.size,\n    'font-style': font.style,\n    \"font-family\": font.face,\n    'font-weight': font.weight,\n    'text-decoration': font.decoration,\n    'class': this.addClasses(klass)\n  };\n  attr.font = \"\"; // There is a spurious font definition that is put on all text elements. This overwrites it.\n\n  return {\n    font: font,\n    attr: attr\n  };\n};\n\nRenderer.prototype.getTextSize = function (text, type, klass) {\n  var hash = this.getFontAndAttr(type, klass);\n  var size = this.paper.getTextSize(text, hash.attr);\n\n  if (hash.font.box) {\n    size.height += 8; // TODO-PER: Shouldn't the width also be increased here?\n  }\n\n  return size;\n};\n\nRenderer.prototype.renderText = function (x, y, text, type, klass, anchor, centerVertically) {\n  var hash = this.getFontAndAttr(type, klass);\n  if (anchor) hash.attr[\"text-anchor\"] = anchor;\n  hash.attr.x = x;\n  hash.attr.y = y + 7; // TODO-PER: Not sure why the text appears to be 7 pixels off.\n\n  if (!centerVertically) hash.attr.dy = \"0.5em\";\n\n  if (type === 'debugfont') {\n    console.log(\"Debug msg: \" + text);\n    hash.attr.stroke = \"#ff0000\";\n  }\n\n  text = text.replace(/\\n\\n/g, \"\\n \\n\");\n  text = text.replace(/^\\n/, \"\\xA0\\n\");\n  var el = this.paper.text(text, hash.attr);\n\n  if (hash.font.box) {\n    var size = el.getBBox();\n    var padding = 2;\n    var margin = 2;\n    this.paper.rect({\n      x: size.x - padding,\n      y: size.y + padding,\n      width: size.width + padding * 2,\n      height: size.height + padding * 2 - margin,\n      stroke: \"#888888\",\n      fill: \"transparent\"\n    }); //size.height += 8;\n  }\n\n  if (this.doRegression) this.addToRegression(el);\n  return el;\n};\n\nRenderer.prototype.moveY = function (em, numLines) {\n  if (numLines === undefined) numLines = 1;\n  this.y += em * numLines;\n};\n\nRenderer.prototype.skipSpaceY = function () {\n  this.y += this.space;\n}; // Call with 'kind' being the font type to use,\n// if marginBottom === null then don't increment the Y after printing, otherwise that is the extra number of em's to leave below the line.\n// and alignment being \"start\", \"middle\", or \"end\".\n\n\nRenderer.prototype.outputTextIf = function (x, str, kind, klass, marginTop, marginBottom, alignment) {\n  if (str) {\n    if (marginTop) this.moveY(marginTop);\n    var el = this.renderText(x, this.y, str, kind, klass, alignment);\n    var bb = el.getBBox(); // This can return NaN if the element isn't visible.\n\n    var width = isNaN(bb.width) ? 0 : bb.width;\n    var height = isNaN(bb.height) ? 0 : bb.height;\n\n    if (marginBottom !== null) {\n      var numLines = str.split(\"\\n\").length;\n      if (!isNaN(bb.height)) this.moveY(height / numLines, numLines + marginBottom);\n    }\n\n    return [width, height];\n  }\n\n  return [0, 0];\n};\n\nRenderer.prototype.addInvisibleMarker = function (className) {\n  var dy = 0.35;\n  var fill = \"rgba(0,0,0,0)\";\n  var y = this.y;\n  y = Math.round(y);\n  var x1 = 0;\n  var x2 = 100;\n  var pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x1, y - dy, x1 + x2, y - dy, x2, y + dy, x1, y + dy);\n  this.paper.pathToBack({\n    path: pathString,\n    stroke: \"none\",\n    fill: fill,\n    \"fill-opacity\": 0,\n    'class': this.addClasses(className),\n    'data-vertical': y\n  });\n}; // For debugging, it is sometimes useful to know where you are vertically.\n\n\nRenderer.prototype.printHorizontalLine = function (width, vertical, comment) {\n  var dy = 0.35;\n  var fill = \"rgba(0,0,255,.4)\";\n  var y = this.y;\n  if (vertical) y = vertical;\n  y = Math.round(y);\n  this.paper.text(\"\" + Math.round(y), {\n    x: 10,\n    y: y,\n    \"text-anchor\": \"start\",\n    \"font-size\": \"18px\",\n    fill: fill,\n    stroke: fill\n  });\n  var x1 = 50;\n  var x2 = width;\n  var pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x1, y - dy, x1 + x2, y - dy, x2, y + dy, x1, y + dy);\n  this.paper.pathToBack({\n    path: pathString,\n    stroke: \"none\",\n    fill: fill,\n    'class': this.addClasses('staff')\n  });\n\n  for (var i = 1; i < width / 100; i++) {\n    pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", i * 100 - dy, y - 5, i * 100 - dy, y + 5, i * 100 + dy, y - 5, i * 100 + dy, y + 5);\n    this.paper.pathToBack({\n      path: pathString,\n      stroke: \"none\",\n      fill: fill,\n      'class': this.addClasses('staff')\n    });\n  }\n\n  if (comment) this.paper.text(comment, {\n    x: width + 70,\n    y: y,\n    \"text-anchor\": \"start\",\n    \"font-size\": \"18px\",\n    fill: fill,\n    stroke: fill\n  });\n};\n\nRenderer.prototype.printShadedBox = function (x, y, width, height, color, opacity, comment) {\n  var box = this.paper.rect({\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    fill: color,\n    stroke: color,\n    \"fill-opacity\": opacity,\n    \"stroke-opacity\": opacity\n  });\n  if (comment) this.paper.text(comment, {\n    x: 0,\n    y: y + 7,\n    \"text-anchor\": \"start\",\n    \"font-size\": \"14px\",\n    fill: \"rgba(0,0,255,.4)\",\n    stroke: \"rgba(0,0,255,.4)\"\n  });\n  return box;\n};\n\nRenderer.prototype.printVerticalLine = function (x, y1, y2) {\n  var dy = 0.35;\n  var fill = \"#00aaaa\";\n  var pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x - dy, y1, x - dy, y2, x + dy, y1, x + dy, y2);\n  this.paper.pathToBack({\n    path: pathString,\n    stroke: \"none\",\n    fill: fill,\n    'class': this.addClasses('staff')\n  });\n  pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x - 20, y1, x - 20, y1 + 3, x, y1, x, y1 + 3);\n  this.paper.pathToBack({\n    path: pathString,\n    stroke: \"none\",\n    fill: fill,\n    'class': this.addClasses('staff')\n  });\n  pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x + 20, y2, x + 20, y2 + 3, x, y2, x, y2 + 3);\n  this.paper.pathToBack({\n    path: pathString,\n    stroke: \"none\",\n    fill: fill,\n    'class': this.addClasses('staff')\n  });\n};\n/**\n * @private\n */\n\n\nRenderer.prototype.addToRegression = function (el) {\n  var box = el.getBBox(); //var str = \"(\"+box.x+\",\"+box.y+\")[\"+box.width+\",\"+box.height+\"] \"\n\n  var str = el.type + ' ' + box.toString() + ' ';\n  var attrs = [];\n\n  for (var key in el.attrs) {\n    if (el.attrs.hasOwnProperty(key)) {\n      if (key === 'class') str = el.attrs[key] + \" \" + str;else attrs.push(key + \": \" + el.attrs[key]);\n    }\n  }\n\n  attrs.sort();\n  str += \"{ \" + attrs.join(\" \") + \" }\";\n  this.regressionLines.push(str);\n};\n\nmodule.exports = Renderer;","map":{"version":3,"sources":["/Users/HTMusic/Desktop/PROJECTS/subdivision-app/subdivision-app_v2/node_modules/abcjs/src/write/abc_renderer.js"],"names":["glyphs","require","spacing","sprintf","Svg","Renderer","paper","doRegression","shouldAddClasses","controller","space","SPACE","padding","regressionLines","reset","prototype","clear","y","abctune","lastM","ingroup","path","isPrint","initVerticalSpace","createElemSet","openGroup","closeElemSet","closeGroup","setPrintMode","setPaperSize","maxwidth","scale","responsive","w","right","h","bottom","Math","max","push","text","metaText","title","setTitle","parentStyles","overflow","setResponsiveWidth","width","height","setSize","setScale","setParentStyles","setPaddingOverride","params","paddingOverride","top","paddingtop","paddingbottom","paddingright","left","paddingleft","setPadding","setPaddingVariable","self","paddingKey","formattingKey","printDefault","screenDefault","formatting","undefined","adjustNonScaledItems","headerfont","size","footerfont","composer","graceBefore","graceInside","graceAfter","info","lineSkipFactor","music","paragraphSkipFactor","parts","slurHeight","staffSeparation","stemHeight","subtitle","systemStaffSeparation","vocal","words","setVerticalSpace","staffsep","composerspace","partsspace","textspace","musicspace","titlespace","sysstaffsep","subtitlespace","topspace","vocalspace","wordsspace","topMargin","moveY","addMusicPadding","addStaffPadding","lastStaffGroup","thisStaffGroup","lastStaff","staffs","length","lastBottomLine","nextTopLine","naturalSeparation","separationInPixels","STEP","engraveTopText","header","headerTextHeight","getTextSize","outputTextIf","center","lines","rhythm","origin","rSpace","composerLine","author","partOrder","engraveExtraText","lineNumber","measureNumber","noteNumber","voiceNumber","extraText","unalignedWords","j","k","INDENT","book","source","discography","notes","transcription","history","footer","outputFreeText","hash","getFontAndAttr","attr","str","isCentered","i","font","alignment","x","outputSubtitle","beginGroup","addPath","ii","endGroup","klass","join","ret","stroke","fill","addClasses","addToRegression","printStaveLine","x1","x2","pitch","extraClass","isIE","dy","calcY","pathString","pathToBack","printStem","dx","y1","y2","tmp","pathArray","kernSymbols","lastSymbol","thisSymbol","lastSymbolWidth","printSymbol","offset","symbol","scalex","scaley","el","ycorr","indexOf","s","charAt","getYCorr","getSymbolWidth","renderText","getPathForSymbol","scaleExistingElem","elem","scaleX","scaleY","setAttributeOnElement","style","printPath","attrs","drawBrace","xLeft","yTop","yBottom","yHeight","xCurve","yCurve","ret1","ret2","drawArc","pitch1","pitch2","above","isTie","norm","sqrt","ux","uy","flatten","maxFlatten","curve","min","controlx1","controly1","controlx2","controly2","thickness","ofs","printStave","startx","endx","numLines","prepend","c","isNote","split","type","face","decoration","weight","box","anchor","centerVertically","console","log","replace","getBBox","margin","rect","em","skipSpaceY","kind","marginTop","marginBottom","bb","isNaN","addInvisibleMarker","className","round","printHorizontalLine","vertical","comment","printShadedBox","color","opacity","printVerticalLine","toString","key","hasOwnProperty","sort","module","exports"],"mappings":"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","sourcesContent":["//    abc_renderer.js: API to render to SVG/Raphael/whatever rendering engine\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com)\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n/*global Math, console */\n\nvar glyphs = require('./abc_glyphs');\nvar spacing = require('./abc_spacing');\nvar sprintf = require('./sprintf');\nvar Svg = require('./svg');\n\n/**\n * Implements the API for rendering ABCJS Abstract Rendering Structure to a canvas/paper (e.g. SVG, Raphael, etc)\n * @param {Object} paper\n * @param {bool} doRegression\n */\nvar Renderer = function(paper, doRegression, shouldAddClasses) {\n  this.paper = new Svg(paper);\n  this.controller = null; //TODO-GD only used when drawing the ABCJS ARS to connect the controller with the elements for highlighting\n\n\tthis.space = 3*spacing.SPACE;\n  this.padding = {}; // renderer's padding is managed by the controller\n  this.doRegression = doRegression;\n  this.shouldAddClasses = shouldAddClasses;\n  if (this.doRegression)\n    this.regressionLines = [];\n\tthis.reset();\n};\n\nRenderer.prototype.reset = function() {\n\n\tthis.paper.clear();\n\tthis.y = 0;\n\tthis.abctune = null;\n\tthis.lastM = null;\n\tthis.ingroup = false;\n\tthis.path = null;\n\tthis.isPrint = false;\n\tthis.initVerticalSpace();\n\tif (this.doRegression)\n\t\tthis.regressionLines = [];\n\t// HACK-PER: There was a problem in Raphael where every path string that was sent to it was cached.\n\t// That was causing the browser's memory to steadily grow until the browser went slower and slower until\n\t// it crashed. The fix to that was a patch to Raphael, so it is only patched on the versions of this library that\n\t// bundle Raphael with it. Also, if Raphael gets an update, then that patch will be lost. On version 2.1.2 of Raphael,\n\t// the patch is on line 1542 and 1545 and it is:\n\t//             p[ps].sleep = 1;\n};\n\nRenderer.prototype.createElemSet = function() {\n\treturn this.paper.openGroup();\n};\n\nRenderer.prototype.closeElemSet = function() {\n\treturn this.paper.closeGroup();\n};\n\n/**\n * Set whether we are formatting this for the screen, or as a preview for creating a PDF version.\n * @param {bool} isPrint\n */\nRenderer.prototype.setPrintMode = function (isPrint) {\n\tthis.isPrint = isPrint;\n};\n\n/**\n * Set the size of the canvas.\n * @param {object} maxwidth\n * @param {object} scale\n */\nRenderer.prototype.setPaperSize = function (maxwidth, scale, responsive) {\n\tvar w = (maxwidth+this.padding.right)*scale;\n\tvar h = (this.y+this.padding.bottom)*scale;\n\tif (this.isPrint)\n\t\th = Math.max(h, 1056); // 11in x 72pt/in x 1.33px/pt\n\t// TODO-PER: We are letting the page get as long as it needs now, but eventually that should go to a second page.\n\tif (this.doRegression)\n\t\tthis.regressionLines.push(\"PAPER SIZE: (\"+w+\",\"+h+\")\");\n\n\t// for accessibility\n\tvar text = \"Sheet Music\";\n\tif (this.abctune && this.abctune.metaText && this.abctune.metaText.title)\n\t\ttext += \" for \\\"\" + this.abctune.metaText.title + '\"';\n\tthis.paper.setTitle(text);\n\n\tvar parentStyles = { overflow: \"hidden\" };\n\tif (responsive === 'resize') {\n\t\tthis.paper.setResponsiveWidth(w, h);\n\t} else {\n\t\tparentStyles.width = \"\";\n\t\tparentStyles.height = h + \"px\";\n\t\tif (scale < 1) {\n\t\t\tparentStyles.width = w + \"px\";\n\t\t\tthis.paper.setSize(w / scale, h / scale);\n\t\t} else\n\t\t\tthis.paper.setSize(w, h);\n\t}\n\tthis.paper.setScale(scale);\n\tthis.paper.setParentStyles(parentStyles);\n};\n\n/**\n * Set the padding\n * @param {object} params\n */\nRenderer.prototype.setPaddingOverride = function(params) {\n\tthis.paddingOverride = { top: params.paddingtop, bottom: params.paddingbottom,\n\t\tright: params.paddingright, left: params.paddingleft };\n};\n\n/**\n * Set the padding\n * @param {object} params\n */\nRenderer.prototype.setPadding = function(abctune) {\n\t// If the padding is set in the tune, then use that.\n\t// Otherwise, if the padding is set in the override, use that.\n\t// Otherwise, use the defaults (there are a different set of defaults for screen and print.)\n\tfunction setPaddingVariable(self, paddingKey, formattingKey, printDefault, screenDefault) {\n\t\tif (abctune.formatting[formattingKey] !== undefined)\n\t\t\tself.padding[paddingKey] = abctune.formatting[formattingKey];\n\t\telse if (self.paddingOverride[paddingKey] !== undefined)\n\t\t\tself.padding[paddingKey] = self.paddingOverride[paddingKey];\n\t\telse if (self.isPrint)\n\t\t\tself.padding[paddingKey] = printDefault;\n\t\telse\n\t\t\tself.padding[paddingKey] = screenDefault;\n\t}\n\t// 1cm x 0.393701in/cm x 72pt/in x 1.33px/pt = 38px\n\t// 1.8cm x 0.393701in/cm x 72pt/in x 1.33px/pt = 68px\n\tsetPaddingVariable(this, 'top', 'topmargin', 38, 15);\n\tsetPaddingVariable(this, 'bottom', 'botmargin', 38, 15);\n\tsetPaddingVariable(this, 'left', 'leftmargin', 68, 15);\n\tsetPaddingVariable(this, 'right', 'rightmargin', 68, 15);\n};\n\n/**\n * Some of the items on the page are not scaled, so adjust them in the opposite direction of scaling to cancel out the scaling.\n * @param {float} scale\n */\nRenderer.prototype.adjustNonScaledItems = function (scale) {\n\tthis.padding.top /= scale;\n\tthis.padding.bottom /= scale;\n\tthis.padding.left /= scale;\n\tthis.padding.right /= scale;\n\tthis.abctune.formatting.headerfont.size /= scale;\n\tthis.abctune.formatting.footerfont.size /= scale;\n};\n\n/**\n * Set the the values for all the configurable vertical space options.\n */\nRenderer.prototype.initVerticalSpace = function() {\n\t// conversion: 37.7953 = conversion factor for cm to px.\n\t// All of the following values are in px.\n\tthis.spacing = {\n\t\tcomposer: 7.56, // Set the vertical space above the composer.\n\t\tgraceBefore: 8.67, // Define the space before, inside and after the grace notes.\n\t\tgraceInside: 10.67,\n\t\tgraceAfter: 16,\n\t\tinfo: 0, // Set the vertical space above the infoline.\n\t\tlineSkipFactor: 1.1, // Set the factor for spacing between lines of text. (multiply this by the font size)\n\t\tmusic: 7.56, // Set the vertical space above the first staff.\n\t\tparagraphSkipFactor: 0.4, // Set the factor for spacing between text paragraphs. (multiply this by the font size)\n\t\tparts: 11.33, // Set the vertical space above a new part.\n\t\tslurHeight: 1.0, // Set the slur height factor.\n\t\tstaffSeparation: 61.33, // Do not put a staff system closer than <unit> from the previous system.\n\t\tstemHeight: 26.67+10, // Set the stem height.\n\t\tsubtitle: 3.78, // Set the vertical space above the subtitle.\n\t\tsystemStaffSeparation: 48, // Do not place the staves closer than <unit> inside a system. * This values applies to all staves when in the tune header. Otherwise, it applies to the next staff\n\t\ttext: 18.9, // Set the vertical space above the history.\n\t\ttitle: 7.56, // Set the vertical space above the title.\n\t\ttop: 30.24, //Set the vertical space above the tunes and on the top of the continuation pages.\n\t\tvocal: 30.67, // Set the vertical space above the lyrics under the staves.\n\t\twords: 0 // Set the vertical space above the lyrics at the end of the tune.\n\t};\n\t/*\n\tTODO-PER: Handle the x-coordinate spacing items, too.\nmaxshrink <float>Default: 0.65\nSet how much to compress horizontally when music line breaks\nare automatic.\n<float> must be between 0 (natural spacing)\nand 1 (max shrinking).\n\n// This next value is used to compute the natural spacing of\n// the notes. The base spacing of the crotchet is always\n// 40 pts. When the duration of a note type is twice the\n// duration of an other note type, its spacing is multiplied\n// by this factor.\n// The default value causes the note spacing to be multiplied\n// by 2 when its duration is multiplied by 4, i.e. the\n// space of the semibreve is 80 pts and the space of the\n// semiquaver is 20 pts.\n// Setting this value to 1 sets all note spacing to 40 pts.\nnoteSpacingFactor: 1.414, // Set the note spacing factor to <float> (range 1..2).\n\nscale <float> Default: 0.75 Set the page scale factor. Note that the header and footer are not scaled.\n\nstretchlast <float>Default: 0.8\nStretch the last music line of a tune when it exceeds\nthe <float> fraction of the page width.\n<float> range is 0.0 to 1.0.\n\t */\n};\n\nRenderer.prototype.setVerticalSpace = function(formatting) {\n\t// conversion from pts to px 4/3\n\tif (formatting.staffsep !== undefined)\n\t\tthis.spacing.staffSeparation = formatting.staffsep *4/3;\n\tif (formatting.composerspace !== undefined)\n\t\tthis.spacing.composer = formatting.composerspace *4/3;\n\tif (formatting.partsspace !== undefined)\n\t\tthis.spacing.parts = formatting.partsspace *4/3;\n\tif (formatting.textspace !== undefined)\n\t\tthis.spacing.text = formatting.textspace *4/3;\n\tif (formatting.musicspace !== undefined)\n\t\tthis.spacing.music = formatting.musicspace *4/3;\n\tif (formatting.titlespace !== undefined)\n\t\tthis.spacing.title = formatting.titlespace *4/3;\n\tif (formatting.sysstaffsep !== undefined)\n\t\tthis.spacing.systemStaffSeparation = formatting.sysstaffsep *4/3;\n\tif (formatting.subtitlespace !== undefined)\n\t\tthis.spacing.subtitle = formatting.subtitlespace *4/3;\n\tif (formatting.topspace !== undefined)\n\t\tthis.spacing.top = formatting.topspace *4/3;\n\tif (formatting.vocalspace !== undefined)\n\t\tthis.spacing.vocal = formatting.vocalspace *4/3;\n\tif (formatting.wordsspace !== undefined)\n\t\tthis.spacing.words = formatting.wordsspace *4/3;\n};\n\n/**\n * Leave space at the top of the paper\n * @param {object} abctune\n */\nRenderer.prototype.topMargin = function(abctune) {\n\t\tthis.moveY(this.padding.top);\n};\n\n/**\n * Leave space before printing the music\n */\nRenderer.prototype.addMusicPadding = function() {\n\t\tthis.moveY(this.spacing.music);\n};\n\n/**\n * Leave space before printing a staff system\n */\nRenderer.prototype.addStaffPadding = function(lastStaffGroup, thisStaffGroup) {\n\tvar lastStaff = lastStaffGroup.staffs[lastStaffGroup.staffs.length-1];\n\tvar lastBottomLine = -(lastStaff.bottom - 2); // The 2 is because the scale goes to 2 below the last line.\n\tvar nextTopLine = thisStaffGroup.staffs[0].top - 10; // Because 10 represents the top line.\n\tvar naturalSeparation = nextTopLine + lastBottomLine; // This is how far apart they'd be without extra spacing\n\tvar separationInPixels = naturalSeparation * spacing.STEP;\n\tif (separationInPixels < this.spacing.staffSeparation)\n\t\tthis.moveY(this.spacing.staffSeparation-separationInPixels);\n};\n\n/**\n * Text that goes above the score\n * @param {number} width\n * @param {object} abctune\n */\nRenderer.prototype.engraveTopText = function(width, abctune) {\n\tif (abctune.metaText.header && this.isPrint) {\n\t\t// Note: whether there is a header or not doesn't change any other positioning, so this doesn't change the Y-coordinate.\n\t\t// This text goes above the margin, so we'll temporarily move up.\n\t\tvar headerTextHeight = this.getTextSize(\"XXXX\", \"headerfont\", 'abcjs-header abcjs-meta-top').height;\n\t\tthis.y -=headerTextHeight;\n\t\tthis.outputTextIf(this.padding.left, abctune.metaText.header.left, 'headerfont', 'header meta-top', 0, null, 'start');\n\t\tthis.outputTextIf(this.padding.left + width / 2, abctune.metaText.header.center, 'headerfont', 'header meta-top', 0, null, 'middle');\n\t\tthis.outputTextIf(this.padding.left + width, abctune.metaText.header.right, 'headerfont', 'header meta-top', 0, null, 'end');\n\t\tthis.y += headerTextHeight;\n\t}\n\tif (this.isPrint)\n\t\tthis.moveY(this.spacing.top);\n\tthis.outputTextIf(this.padding.left + width / 2, abctune.metaText.title, 'titlefont', 'title meta-top', this.spacing.title, 0, 'middle');\n\tif (abctune.lines[0])\n\t\tthis.outputTextIf(this.padding.left + width / 2, abctune.lines[0].subtitle, 'subtitlefont', 'text meta-top', this.spacing.subtitle, 0, 'middle');\n\n\tif (abctune.metaText.rhythm || abctune.metaText.origin || abctune.metaText.composer) {\n\t\tthis.moveY(this.spacing.composer);\n\t\tvar rSpace = this.outputTextIf(this.padding.left, abctune.metaText.rhythm, 'infofont', 'meta-top', 0, null, \"start\");\n\n\t\tvar composerLine = \"\";\n\t\tif (abctune.metaText.composer) composerLine += abctune.metaText.composer;\n\t\tif (abctune.metaText.origin) composerLine += ' (' + abctune.metaText.origin + ')';\n\t\tif (composerLine.length > 0) {\n\t\t\tvar space = this.outputTextIf(this.padding.left + width, composerLine, 'composerfont', 'meta-top', 0, null, \"end\");\n\t\t\tthis.moveY(space[1]);\n\t\t} else {\n\t\t\tthis.moveY(rSpace[1]);\n\t\t}\n\t\t// TODO-PER: The following is a hack to make the elements line up with abcm2ps. Don't know where the extra space is coming from.\n\t\tthis.moveY(-6);\n\t//} else if (this.isPrint) {\n\t//\t// abcm2ps adds this space whether there is anything to write or not.\n\t//\tthis.moveY(this.spacing.composer);\n\t//\tvar space2 = this.getTextSize(\"M\", 'composerfont', 'meta-top');\n\t//\tthis.moveY(space2.height);\n\t}\n\n\tthis.outputTextIf(this.padding.left + width, abctune.metaText.author, 'composerfont', 'meta-top', 0, 0, \"end\");\n\t//this.skipSpaceY();\n\n\tthis.outputTextIf(this.padding.left, abctune.metaText.partOrder, 'partsfont', 'meta-bottom', 0, 0, \"start\");\n};\n\n/**\n * Text that goes below the score\n * @param {number} width\n * @param {object} abctune\n */\nRenderer.prototype.engraveExtraText = function(width, abctune) {\n\tthis.lineNumber = null;\n\tthis.measureNumber = null;\n\tthis.noteNumber = null;\n\tthis.voiceNumber = null;\n\n\tvar extraText;\n\tif (abctune.metaText.unalignedWords) {\n\t\textraText = \"\";\n\t\tfor (var j = 0; j < abctune.metaText.unalignedWords.length; j++) {\n\t\t\tif (typeof abctune.metaText.unalignedWords[j] === 'string')\n\t\t\t\textraText += abctune.metaText.unalignedWords[j] + \"\\n\";\n\t\t\telse {\n\t\t\t\tfor (var k = 0; k < abctune.metaText.unalignedWords[j].length; k++) {\n\t\t\t\t\textraText += \" FONT \" + abctune.metaText.unalignedWords[j][k].text;\n\t\t\t\t}\n\t\t\t\textraText += \"\\n\";\n\t\t\t}\n\t\t}\n\t\tthis.outputTextIf(this.padding.left + spacing.INDENT, extraText, 'wordsfont', 'meta-bottom', this.spacing.words, 2, \"start\");\n\t}\n\n\textraText = \"\";\n\tif (abctune.metaText.book) extraText += \"Book: \" + abctune.metaText.book + \"\\n\";\n\tif (abctune.metaText.source) extraText += \"Source: \" + abctune.metaText.source + \"\\n\";\n\tif (abctune.metaText.discography) extraText += \"Discography: \" + abctune.metaText.discography + \"\\n\";\n\tif (abctune.metaText.notes) extraText += \"Notes: \" + abctune.metaText.notes + \"\\n\";\n\tif (abctune.metaText.transcription) extraText += \"Transcription: \" + abctune.metaText.transcription + \"\\n\";\n\tif (abctune.metaText.history) extraText += \"History: \" + abctune.metaText.history + \"\\n\";\n\tif (abctune.metaText['abc-copyright']) extraText += \"Copyright: \" + abctune.metaText['abc-copyright'] + \"\\n\";\n\tif (abctune.metaText['abc-creator']) extraText += \"Creator: \" + abctune.metaText['abc-creator'] + \"\\n\";\n\tif (abctune.metaText['abc-edited-by']) extraText += \"Edited By: \" + abctune.metaText['abc-edited-by'] + \"\\n\";\n\tthis.outputTextIf(this.padding.left, extraText, 'historyfont', 'meta-bottom', this.spacing.info, 0, \"start\");\n\n\tif (abctune.metaText.footer && this.isPrint) {\n\t\t// Note: whether there is a footer or not doesn't change any other positioning, so this doesn't change the Y-coordinate.\n\t\tthis.outputTextIf(this.padding.left, abctune.metaText.footer.left, 'footerfont', 'header meta-bottom', 0, null, 'start');\n\t\tthis.outputTextIf(this.padding.left + width / 2, abctune.metaText.footer.center, 'footerfont', 'header meta-bottom', 0, null, 'middle');\n\t\tthis.outputTextIf(this.padding.left + width, abctune.metaText.footer.right, 'footerfont', 'header meta-bottom', 0, null, 'end');\n\t}\n};\n\n/**\n * Output text defined with %%text.\n * @param {array or string} text\n */\nRenderer.prototype.outputFreeText = function (text) {\n\tif (text === \"\") {\t// we do want to print out blank lines if they have been specified.\n\t\tvar hash = this.getFontAndAttr('textfont', 'defined-text');\n\t\tthis.moveY(hash.attr['font-size'] * 2); // move the distance of the line, plus the distance of the margin, which is also one line.\n\t} else if (typeof text === 'string')\n\t\tthis.outputTextIf(this.padding.left, text, 'textfont', 'defined-text', 0, 1, \"start\");\n\telse {\n\t\tvar str = \"\";\n\t\tvar isCentered = false; // The structure is wrong here: it requires an array to do centering, but it shouldn't have.\n\t\tfor (var i = 0; i < text.length; i++) {\n\t\t\tif (text[i].font)\n\t\t\t\tstr += \"FONT(\" + text[i].font + \")\";\n\t\t\tstr += text[i].text;\n\t\t\tif (text[i].center)\n\t\t\t\tisCentered = true;\n\t\t}\n\t\tvar alignment = isCentered ? 'middle' : 'start';\n\t\tvar x = isCentered ? this.controller.width / 2 : this.padding.left;\n\t\tthis.outputTextIf(x, str, 'textfont', 'defined-text', 0, 1, alignment);\n\t}\n};\n\n/**\n * Output an extra subtitle that is defined later in the tune.\n */\nRenderer.prototype.outputSubtitle = function (width, subtitle) {\n\tthis.outputTextIf(this.padding.left + width / 2, subtitle, 'subtitlefont', 'text meta-top', this.spacing.subtitle, 0, 'middle');\n};\n\n/**\n * Begin a group of glyphs that will always be moved, scaled and highlighted together\n */\nRenderer.prototype.beginGroup = function () {\n  this.path = [];\n  this.lastM = [0,0];\n  this.ingroup = true;\n};\n\n/**\n * Add a path to the current group\n * @param {Array} path\n * @private\n */\nRenderer.prototype.addPath = function (path) {\n  path = path || [];\n  if (path.length===0) return;\n  path[0][0]=\"m\";\n  path[0][1]-=this.lastM[0];\n  path[0][2]-=this.lastM[1];\n  this.lastM[0]+=path[0][1];\n  this.lastM[1]+=path[0][2];\n  this.path.push(path[0]);\n  for (var i=1,ii=path.length;i<ii;i++) {\n    if (path[i][0]===\"m\") {\n      this.lastM[0]+=path[i][1];\n      this.lastM[1]+=path[i][2];\n    }\n    this.path.push(path[i]);\n  }\n};\n\n/**\n * End a group of glyphs that will always be moved, scaled and highlighted together\n */\nRenderer.prototype.endGroup = function (klass) {\n  this.ingroup = false;\n  if (this.path.length===0) return null;\n  var path = \"\";\n\tfor (var i = 0; i < this.path.length; i++)\n\t\tpath += this.path[i].join(\" \");\n\tvar ret = this.paper.path({path: path, stroke:\"none\", fill:\"#000000\", 'class': this.addClasses(klass)});\n\tthis.path = [];\n  if (this.doRegression) this.addToRegression(ret);\n\n  return ret;\n};\n\n/**\n * gets scaled\n * @param {number} x1 start x\n * @param {number} x2 end x\n * @param {number} pitch pitch the stave line is drawn at\n */\nRenderer.prototype.printStaveLine = function (x1,x2, pitch, klass) {\n\tvar extraClass = \"staff\";\n\tif (klass !== undefined)\n\t\textraClass += \" \" + klass;\n  var isIE=/*@cc_on!@*/false;//IE detector\n  var dy = 0.35;\n  var fill = \"#000000\";\n  if (isIE) {\n    dy = 1;\n    fill = \"#666666\";\n  }\n  var y = this.calcY(pitch);\n  var pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x1, y-dy, x2, y-dy,\n     x2, y+dy, x1, y+dy);\n  var ret = this.paper.pathToBack({path:pathString, stroke:\"none\", fill:fill, 'class': this.addClasses(extraClass)});\n  if (this.doRegression) this.addToRegression(ret);\n\n  return ret;\n};\n\n/**\n * gets scaled if not in a group\n * @param {number} x x coordinate of the stem\n * @param {number} dx stem width\n * @param {number} y1 y coordinate of the stem bottom\n * @param {number} y2 y coordinate of the stem top\n */\nRenderer.prototype.printStem = function (x, dx, y1, y2) {\n  if (dx<0) { // correct path \"handedness\" for intersection with other elements\n    var tmp = y2;\n    y2 = y1;\n    y1 = tmp;\n  }\n  var isIE=/*@cc_on!@*/false;//IE detector\n  var fill = \"#000000\";\n  if (isIE && dx<1) {\n    dx = 1;\n    fill = \"#666666\";\n  }\n  if (~~x === x) x+=0.05; // raphael does weird rounding (for VML)\n  var pathArray = [[\"M\",x,y1],[\"L\", x, y2],[\"L\", x+dx, y2],[\"L\",x+dx,y1],[\"z\"]];\n  if (!isIE && this.ingroup) {\n    this.addPath(pathArray);\n  } else {\n  \tvar path = \"\";\n  \tfor (var i = 0; i < pathArray.length; i++)\n  \t\tpath += pathArray[i].join(\" \");\n    var ret = this.paper.pathToBack({path:path, stroke:\"none\", fill:fill, 'class': this.addClasses('stem')});\n    if (this.doRegression) this.addToRegression(ret);\n\n    return ret;\n  }\n};\n\nfunction kernSymbols(lastSymbol, thisSymbol, lastSymbolWidth) {\n\t// This is just some adjustments to make it look better.\n\tvar width = lastSymbolWidth;\n\tif (lastSymbol === 'f' && thisSymbol === 'f')\n\t\twidth = width*2/3;\n\tif (lastSymbol === 'p' && thisSymbol === 'p')\n\t\twidth = width*5/6;\n\tif (lastSymbol === 'f' && thisSymbol === 'z')\n\t\twidth = width*5/8;\n\treturn width;\n}\n\n/**\n * assumes this.y is set appropriately\n * if symbol is a multichar string without a . (as in scripts.staccato) 1 symbol per char is assumed\n * not scaled if not in printgroup\n */\nRenderer.prototype.printSymbol = function (x, offset, symbol, scalex, scaley, klass) {\n\tvar el;\n\tvar ycorr;\n\tif (!symbol) return null;\n\tif (symbol.length > 1 && symbol.indexOf(\".\") < 0) {\n\t\tthis.paper.openGroup();\n\t\tvar dx = 0;\n\t\tfor (var i = 0; i < symbol.length; i++) {\n\t\t\tvar s = symbol.charAt(i);\n\t\t\tycorr = glyphs.getYCorr(s);\n\t\t\tel = glyphs.printSymbol(x + dx, this.calcY(offset + ycorr), s, this.paper, klass);\n\t\t\tif (el) {\n\t\t\t\tif (this.doRegression) this.addToRegression(el);\n\t\t\t\t//elemset.push(el);\n\t\t\t\tif (i < symbol.length - 1)\n\t\t\t\t\tdx += kernSymbols(s, symbol.charAt(i + 1), glyphs.getSymbolWidth(s));\n\t\t\t} else {\n\t\t\t\tthis.renderText(x, this.y, \"no symbol:\" + symbol, \"debugfont\", 'debug-msg', 'start');\n\t\t\t}\n\t\t}\n\t\treturn this.paper.closeGroup();\n\t} else {\n\t\tycorr = glyphs.getYCorr(symbol);\n\t\tif (this.ingroup) {\n\t\t\tthis.addPath(glyphs.getPathForSymbol(x, this.calcY(offset + ycorr), symbol, scalex, scaley));\n\t\t} else {\n\t\t\tel = glyphs.printSymbol(x, this.calcY(offset + ycorr), symbol, this.paper, klass);\n\t\t\tif (el) {\n\t\t\t\tif (this.doRegression) this.addToRegression(el);\n\t\t\t\treturn el;\n\t\t\t} else\n\t\t\t\tthis.renderText(x, this.y, \"no symbol:\" + symbol, \"debugfont\", 'debug-msg', 'start');\n\t\t}\n\t\treturn null;\n\t}\n};\n\nRenderer.prototype.scaleExistingElem = function (elem, scaleX, scaleY, x, y) {\n\tthis.paper.setAttributeOnElement(elem, { style: \"transform:scale(\"+scaleX+\",\"+scaleY + \");transform-origin:\" + x + \"px \" + y + \"px;\"});\n};\n\nRenderer.prototype.printPath = function (attrs) {\n  var ret = this.paper.path(attrs);\n  if (this.doRegression) this.addToRegression(ret);\n  return ret;\n};\n\nRenderer.prototype.drawBrace = function(xLeft, yTop, yBottom) {//Tony\n\tvar yHeight = yBottom - yTop;\n\n\tvar xCurve = [7.5, -8, 21, 0, 18.5, -10.5, 7.5];\n\tvar yCurve = [0, yHeight/5.5, yHeight/3.14, yHeight/2, yHeight/2.93, yHeight/4.88, 0];\n\n\tvar pathString = sprintf(\"M %f %f C %f %f %f %f %f %f C %f %f %f %f %f %f z\",\n\t\txLeft+xCurve[0], yTop+yCurve[0],\n\t\txLeft+xCurve[1], yTop+yCurve[1],\n\t\txLeft+xCurve[2], yTop+yCurve[2],\n\t\txLeft+xCurve[3], yTop+yCurve[3],\n\t\txLeft+xCurve[4], yTop+yCurve[4],\n\t\txLeft+xCurve[5], yTop+yCurve[5],\n\t\txLeft+xCurve[6], yTop+yCurve[6]);\n\tvar ret1 = this.paper.path({path:pathString, stroke:\"#000000\", fill:\"#000000\", 'class': this.addClasses('brace')});\n\n\txCurve = [0, 17.5, -7.5, 6.6, -5, 20, 0];\n\tyCurve = [yHeight/2, yHeight/1.46, yHeight/1.22, yHeight, yHeight/1.19, yHeight/1.42, yHeight/2];\n\n\tpathString = sprintf(\"M %f %f C %f %f %f %f %f %f C %f %f %f %f %f %f z\",\n\t\txLeft+xCurve[ 0], yTop+yCurve[0],\n\t\txLeft+xCurve[1], yTop+yCurve[1],\n\t\txLeft+xCurve[2], yTop+yCurve[2],\n\t\txLeft+xCurve[3], yTop+yCurve[3],\n\t\txLeft+xCurve[4], yTop+yCurve[4],\n\t\txLeft+xCurve[5], yTop+yCurve[5],\n\t\txLeft+xCurve[6], yTop+yCurve[6]);\n\tvar ret2 = this.paper.path({path:pathString, stroke:\"#000000\", fill:\"#000000\", 'class': this.addClasses('brace')});\n\n\tif (this.doRegression){\n\t\tthis.addToRegression(ret1);\n\t\tthis.addToRegression(ret2);\n\t}\n\treturn ret1 + ret2;\n};\n\nRenderer.prototype.drawArc = function(x1, x2, pitch1, pitch2, above, klass, isTie) {\n\t// If it is a tie vs. a slur, draw it shallower.\n\tvar spacing = isTie ? 1.2 : 1.5;\n\n  x1 = x1 + 6;\n  x2 = x2 + 4;\n  pitch1 = pitch1 + ((above)?spacing:-spacing);\n  pitch2 = pitch2 + ((above)?spacing:-spacing);\n  var y1 = this.calcY(pitch1);\n  var y2 = this.calcY(pitch2);\n\n  //unit direction vector\n  var dx = x2-x1;\n  var dy = y2-y1;\n  var norm= Math.sqrt(dx*dx+dy*dy);\n  var ux = dx/norm;\n  var uy = dy/norm;\n\n  var flatten = norm/3.5;\n  var maxFlatten = isTie ? 10 : 25;  // If it is a tie vs. a slur, draw it shallower.\n  var curve = ((above)?-1:1)*Math.min(maxFlatten, Math.max(4, flatten));\n\n  var controlx1 = x1+flatten*ux-curve*uy;\n  var controly1 = y1+flatten*uy+curve*ux;\n  var controlx2 = x2-flatten*ux-curve*uy;\n  var controly2 = y2-flatten*uy+curve*ux;\n  var thickness = 2;\n  var pathString = sprintf(\"M %f %f C %f %f %f %f %f %f C %f %f %f %f %f %f z\", x1, y1,\n     controlx1, controly1, controlx2, controly2, x2, y2,\n     controlx2-thickness*uy, controly2+thickness*ux, controlx1-thickness*uy, controly1+thickness*ux, x1, y1);\n\tif (klass)\n\t\tklass += ' slur';\n\telse\n\t\tklass = 'slur';\n  var ret = this.paper.path({path:pathString, stroke:\"none\", fill:\"#000000\", 'class': this.addClasses(klass)});\n  if (this.doRegression) this.addToRegression(ret);\n\n  return ret;\n};\n/**\n * Calculates the y for a given pitch value (relative to the stave the renderer is currently printing)\n * @param {number} ofs pitch value (bottom C on a G clef = 0, D=1, etc.)\n */\nRenderer.prototype.calcY = function(ofs) {\n  return this.y - ofs*spacing.STEP;\n};\n\n/**\n * Print @param {number} numLines. If there is 1 line it is the B line. Otherwise the bottom line is the E line.\n */\nRenderer.prototype.printStave = function (startx, endx, numLines) {\n\tvar klass = \"top-line\";\n\tthis.paper.openGroup({ prepend: true });\n\t// If there is one line, it is the B line. Otherwise, the bottom line is the E line.\n\tif (numLines === 1) {\n\t\tthis.printStaveLine(startx,endx,6, klass);\n\t\treturn;\n\t}\n\tfor (var i = numLines-1; i >= 0; i--) {\n\t\tthis.printStaveLine(startx,endx,(i+1)*2, klass);\n\t\tklass = undefined;\n\t}\n\tthis.paper.closeGroup();\n};\n\n/**\n *\n * @private\n */\nRenderer.prototype.addClasses = function (c, isNote) {\n\tif (!this.shouldAddClasses)\n\t\treturn \"\";\n\tvar ret = [];\n\tif (c.length > 0) ret.push(c);\n\tif (this.lineNumber !== null && this.lineNumber !== undefined) ret.push(\"l\"+this.lineNumber);\n\tif (this.measureNumber !== null && this.measureNumber !== undefined) ret.push(\"m\"+this.measureNumber);\n\tif (this.voiceNumber !== null && this.voiceNumber !== undefined) ret.push(\"v\"+this.voiceNumber);\n\tif (c.indexOf('note') >= 0 && this.noteNumber !== null && this.noteNumber !== undefined) ret.push(\"n\"+this.noteNumber);\n\t// add a prefix to all classes that abcjs adds.\n\tif (ret.length > 0) {\n\t\tret = ret.join(' '); // Some strings are compound classes - that is, specify more than one class in a string.\n\t\tret = ret.split(' ');\n\t\tfor (var i = 0; i < ret.length; i++) {\n\t\t\tif (ret[i].indexOf('abcjs-') !== 0 && ret[i].length > 0) // if the prefix doesn't already exist and the class is not blank.\n\t\t\t\tret[i] = 'abcjs-' + ret[i];\n\t\t}\n\t}\n\treturn ret.join(' ');\n};\n\nRenderer.prototype.getFontAndAttr = function(type, klass) {\n\tvar font = this.abctune.formatting[type];\n\t// Raphael deliberately changes the font units to pixels for some reason, so we need to change points to pixels here.\n\tif (font)\n\t\tfont = { face: font.face, size: font.size*4/3, decoration: font.decoration, style: font.style, weight: font.weight, box: font.box };\n\telse\n\t\tfont = { face: \"Arial\", size: 12*4/3, decoration: \"underline\", style: \"normal\", weight: \"normal\" };\n\n\tvar attr = {\"font-size\": font.size, 'font-style': font.style,\n\t\t\"font-family\": font.face, 'font-weight': font.weight, 'text-decoration': font.decoration,\n\t\t'class': this.addClasses(klass) };\n\tattr.font = \"\";\t// There is a spurious font definition that is put on all text elements. This overwrites it.\n\treturn { font: font, attr: attr };\n};\n\nRenderer.prototype.getTextSize = function(text, type, klass) {\n\tvar hash = this.getFontAndAttr(type, klass);\n\tvar size = this.paper.getTextSize(text, hash.attr);\n\tif (hash.font.box) {\n\t\tsize.height += 8;\n\t\t// TODO-PER: Shouldn't the width also be increased here?\n\t}\n\treturn size;\n};\n\nRenderer.prototype.renderText = function(x, y, text, type, klass, anchor, centerVertically) {\n\tvar hash = this.getFontAndAttr(type, klass);\n\tif (anchor)\n\t\thash.attr[\"text-anchor\"] = anchor;\n\thash.attr.x = x;\n\thash.attr.y = y + 7; // TODO-PER: Not sure why the text appears to be 7 pixels off.\n\tif (!centerVertically)\n\t\thash.attr.dy = \"0.5em\";\n\tif (type === 'debugfont') {\n\t\tconsole.log(\"Debug msg: \" + text);\n\t\thash.attr.stroke = \"#ff0000\";\n\t}\n\n\ttext = text.replace(/\\n\\n/g, \"\\n \\n\");\n\ttext = text.replace(/^\\n/, \"\\xA0\\n\");\n\n\tvar el = this.paper.text(text, hash.attr);\n\n\tif (hash.font.box) {\n\t\tvar size = el.getBBox();\n\t\tvar padding = 2;\n\t\tvar margin = 2;\n\t\tthis.paper.rect({ x: size.x - padding, y: size.y + padding, width: size.width + padding*2, height: size.height + padding*2 - margin,  stroke: \"#888888\", fill: \"transparent\"});\n\t\t//size.height += 8;\n\t}\n\tif (this.doRegression) this.addToRegression(el);\n\treturn el;\n};\n\nRenderer.prototype.moveY = function (em, numLines) {\n\tif (numLines === undefined) numLines = 1;\n\tthis.y += em*numLines;\n};\n\nRenderer.prototype.skipSpaceY = function () {\n\tthis.y += this.space;\n};\n\n// Call with 'kind' being the font type to use,\n// if marginBottom === null then don't increment the Y after printing, otherwise that is the extra number of em's to leave below the line.\n// and alignment being \"start\", \"middle\", or \"end\".\nRenderer.prototype.outputTextIf = function(x, str, kind, klass, marginTop, marginBottom, alignment) {\n\tif (str) {\n\t\tif (marginTop)\n\t\t\tthis.moveY(marginTop);\n\t\tvar el = this.renderText(x, this.y, str, kind, klass, alignment);\n\t\tvar bb = el.getBBox(); // This can return NaN if the element isn't visible.\n\t\tvar width = isNaN(bb.width) ? 0 : bb.width;\n\t\tvar height = isNaN(bb.height) ? 0 : bb.height;\n\t\tif (marginBottom !== null) {\n\t\t\tvar numLines = str.split(\"\\n\").length;\n\t\t\tif (!isNaN(bb.height))\n\t\t\t\tthis.moveY(height/numLines, (numLines + marginBottom));\n\t\t}\n\t\treturn [width, height];\n\t}\n\treturn [0,0];\n};\n\nRenderer.prototype.addInvisibleMarker = function (className) {\n\tvar dy = 0.35;\n\tvar fill = \"rgba(0,0,0,0)\";\n\tvar y = this.y;\n\ty = Math.round(y);\n\tvar x1 = 0;\n\tvar x2 = 100;\n\tvar pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x1, y-dy, x1+x2, y-dy,\n\t\tx2, y+dy, x1, y+dy);\n\tthis.paper.pathToBack({path:pathString, stroke:\"none\", fill:fill, \"fill-opacity\": 0, 'class': this.addClasses(className), 'data-vertical': y });\n};\n\n// For debugging, it is sometimes useful to know where you are vertically.\nRenderer.prototype.printHorizontalLine = function (width, vertical, comment) {\n\tvar dy = 0.35;\n\tvar fill = \"rgba(0,0,255,.4)\";\n\tvar y = this.y;\n\tif (vertical) y = vertical;\n\ty = Math.round(y);\n\tthis.paper.text(\"\"+Math.round(y), {x: 10, y: y, \"text-anchor\": \"start\", \"font-size\":\"18px\", fill: fill, stroke: fill });\n\tvar x1 = 50;\n\tvar x2 = width;\n\tvar pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x1, y-dy, x1+x2, y-dy,\n\t\tx2, y+dy, x1, y+dy);\n\tthis.paper.pathToBack({path:pathString, stroke:\"none\", fill:fill, 'class': this.addClasses('staff')});\n\tfor (var i = 1; i < width/100; i++) {\n\t\tpathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", i*100-dy, y-5, i*100-dy, y+5,\n\t\t\ti*100+dy, y-5, i*100+dy, y+5);\n\t\tthis.paper.pathToBack({path:pathString, stroke:\"none\", fill:fill, 'class': this.addClasses('staff')});\n\t}\n\tif (comment)\n\t\tthis.paper.text(comment, {x: width+70, y: y, \"text-anchor\": \"start\", \"font-size\":\"18px\", fill: fill, stroke: fill });\n};\n\nRenderer.prototype.printShadedBox = function (x, y, width, height, color, opacity, comment) {\n\tvar box = this.paper.rect({ x: x, y: y, width: width, height: height, fill: color, stroke: color, \"fill-opacity\": opacity, \"stroke-opacity\": opacity });\n\tif (comment)\n\t\tthis.paper.text(comment, {x: 0, y: y+7, \"text-anchor\": \"start\", \"font-size\":\"14px\", fill: \"rgba(0,0,255,.4)\", stroke: \"rgba(0,0,255,.4)\" });\n\treturn box;\n};\n\nRenderer.prototype.printVerticalLine = function (x, y1, y2) {\n\tvar dy = 0.35;\n\tvar fill = \"#00aaaa\";\n\tvar pathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x - dy, y1, x - dy, y2,\n\t\t\tx + dy, y1, x + dy, y2);\n\tthis.paper.pathToBack({path: pathString, stroke: \"none\", fill: fill, 'class': this.addClasses('staff')});\n\tpathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x - 20, y1, x - 20, y1+3,\n\t\tx, y1, x, y1+3);\n\tthis.paper.pathToBack({path: pathString, stroke: \"none\", fill: fill, 'class': this.addClasses('staff')});\n\tpathString = sprintf(\"M %f %f L %f %f L %f %f L %f %f z\", x + 20, y2, x + 20, y2+3,\n\t\tx, y2, x, y2+3);\n\tthis.paper.pathToBack({path: pathString, stroke: \"none\", fill: fill, 'class': this.addClasses('staff')});\n\n};\n\n/**\n * @private\n */\nRenderer.prototype.addToRegression = function (el) {\n\tvar box = el.getBBox();\n\t//var str = \"(\"+box.x+\",\"+box.y+\")[\"+box.width+\",\"+box.height+\"] \"\n\tvar str = el.type + ' ' + box.toString() + ' ';\n\tvar attrs = [];\n\tfor (var key in el.attrs) {\n\t\tif (el.attrs.hasOwnProperty(key)) {\n\t\t\tif (key === 'class')\n\t\t\t\tstr = el.attrs[key] + \" \" + str;\n\t\t\telse\n\t\t\t\tattrs.push(key+\": \"+el.attrs[key]);\n\t\t}\n\t}\n\tattrs.sort();\n\tstr += \"{ \" +attrs.join(\" \") + \" }\";\n\tthis.regressionLines.push(str);\n};\n\nmodule.exports = Renderer;\n"]},"metadata":{},"sourceType":"script"}