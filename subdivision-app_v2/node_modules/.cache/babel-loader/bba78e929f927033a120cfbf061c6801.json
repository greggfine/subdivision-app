{"ast":null,"code":"//    abc_midi_create.js: Turn a linear series of events into a midi file.\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\nvar flatten = require('./abc_midi_flattener');\n\nvar Preparer = require('./abc_midi_js_preparer');\n\nvar rendererFactory = require('./abc_midi_renderer');\n\nvar sequence = require('./abc_midi_sequencer');\n\nvar create;\n\n(function () {\n  \"use strict\";\n\n  var baseDuration = 480 * 4; // nice and divisible, equals 1 whole note\n\n  create = function (abcTune, options) {\n    if (options === undefined) options = {};\n    var sequenceInst = sequence(abcTune, options);\n    var commands = flatten(sequenceInst, options);\n    var midi = rendererFactory();\n    var midiJs = new Preparer();\n    var title = abcTune.metaText ? abcTune.metaText.title : undefined;\n    if (title && title.length > 128) title = title.substring(0, 124) + '...';\n    midi.setGlobalInfo(commands.tempo, title);\n    midiJs.setGlobalInfo(commands.tempo, title);\n\n    for (var i = 0; i < commands.tracks.length; i++) {\n      midi.startTrack();\n      midiJs.startTrack();\n\n      for (var j = 0; j < commands.tracks[i].length; j++) {\n        var event = commands.tracks[i][j];\n\n        switch (event.cmd) {\n          case 'program':\n            midi.setChannel(event.channel);\n            midi.setInstrument(event.instrument);\n            midiJs.setChannel(event.channel);\n            midiJs.setInstrument(event.instrument);\n            break;\n\n          case 'start':\n            midi.startNote(convertPitch(event.pitch), event.volume);\n            midiJs.startNote(convertPitch(event.pitch), event.volume);\n            break;\n\n          case 'stop':\n            midi.endNote(convertPitch(event.pitch), 0); // TODO-PER: Refactor: the old midi used a duration here.\n\n            midiJs.endNote(convertPitch(event.pitch));\n            break;\n\n          case 'move':\n            midi.addRest(event.duration * baseDuration);\n            midiJs.addRest(event.duration * baseDuration);\n            break;\n\n          default:\n            console.log(\"MIDI create Unknown: \" + event.cmd);\n        }\n      }\n\n      midi.endTrack();\n      midiJs.endTrack();\n    }\n\n    var midiFile = midi.getData();\n    var midiInline = midiJs.getData();\n    if (options.generateInline === undefined) // default is to generate inline controls.\n      options.generateInline = true;\n    if (options.generateInline && options.generateDownload) return {\n      download: midiFile,\n      inline: midiInline\n    };else if (options.generateInline) return midiInline;else return midiFile;\n  };\n\n  function convertPitch(pitch) {\n    return 60 + pitch;\n  }\n})();\n\nmodule.exports = create;","map":{"version":3,"sources":["/Users/HTMusic/Desktop/PROJECTS/subdivision-app/subdivision-app_v2/node_modules/abcjs/src/midi/abc_midi_create.js"],"names":["flatten","require","Preparer","rendererFactory","sequence","create","baseDuration","abcTune","options","undefined","sequenceInst","commands","midi","midiJs","title","metaText","length","substring","setGlobalInfo","tempo","i","tracks","startTrack","j","event","cmd","setChannel","channel","setInstrument","instrument","startNote","convertPitch","pitch","volume","endNote","addRest","duration","console","log","endTrack","midiFile","getData","midiInline","generateInline","generateDownload","download","inline","module","exports"],"mappings":"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","sourcesContent":["//    abc_midi_create.js: Turn a linear series of events into a midi file.\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar flatten = require('./abc_midi_flattener');\nvar Preparer = require('./abc_midi_js_preparer');\nvar rendererFactory = require('./abc_midi_renderer');\nvar sequence = require('./abc_midi_sequencer');\n\nvar create;\n\n(function() {\n\t\"use strict\";\n\n\tvar baseDuration = 480*4; // nice and divisible, equals 1 whole note\n\n\tcreate = function(abcTune, options) {\n\t\tif (options === undefined) options = {};\n\t\tvar sequenceInst = sequence(abcTune, options);\n\t\tvar commands = flatten(sequenceInst, options);\n\t\tvar midi = rendererFactory();\n\t\tvar midiJs = new Preparer();\n\n\t\tvar title = abcTune.metaText ? abcTune.metaText.title : undefined;\n\t\tif (title && title.length > 128)\n\t\t\ttitle = title.substring(0,124) + '...';\n\t\tmidi.setGlobalInfo(commands.tempo, title);\n\t\tmidiJs.setGlobalInfo(commands.tempo, title);\n\n\t\tfor (var i = 0; i < commands.tracks.length; i++) {\n\t\t\tmidi.startTrack();\n\t\t\tmidiJs.startTrack();\n\t\t\tfor (var j = 0; j < commands.tracks[i].length; j++) {\n\t\t\t\tvar event = commands.tracks[i][j];\n\t\t\t\tswitch (event.cmd) {\n\t\t\t\t\tcase 'program':\n\t\t\t\t\t\tmidi.setChannel(event.channel);\n\t\t\t\t\t\tmidi.setInstrument(event.instrument);\n\t\t\t\t\t\tmidiJs.setChannel(event.channel);\n\t\t\t\t\t\tmidiJs.setInstrument(event.instrument);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'start':\n\t\t\t\t\t\tmidi.startNote(convertPitch(event.pitch), event.volume);\n\t\t\t\t\t\tmidiJs.startNote(convertPitch(event.pitch), event.volume);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'stop':\n\t\t\t\t\t\tmidi.endNote(convertPitch(event.pitch), 0); // TODO-PER: Refactor: the old midi used a duration here.\n\t\t\t\t\t\tmidiJs.endNote(convertPitch(event.pitch));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'move':\n\t\t\t\t\t\tmidi.addRest(event.duration * baseDuration);\n\t\t\t\t\t\tmidiJs.addRest(event.duration * baseDuration);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log(\"MIDI create Unknown: \" + event.cmd);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmidi.endTrack();\n\t\t\tmidiJs.endTrack();\n\t\t}\n\n\t\tvar midiFile = midi.getData();\n\t\tvar midiInline = midiJs.getData();\n\t\tif (options.generateInline === undefined) // default is to generate inline controls.\n\t\t\toptions.generateInline = true;\n\t\tif (options.generateInline && options.generateDownload)\n\t\t\treturn { download: midiFile, inline: midiInline };\n\t\telse if (options.generateInline)\n\t\t\treturn midiInline;\n\t\telse\n\t\t\treturn midiFile;\n\t};\n\n\tfunction convertPitch(pitch) {\n\t\treturn 60 + pitch;\n\t}\n})();\n\nmodule.exports = create;\n"]},"metadata":{},"sourceType":"script"}